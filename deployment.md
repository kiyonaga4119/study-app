# XServerへのデプロイ手順

XServer（スタンダードプラン等）でこのアプリケーションを動作させるための手順です。
XServerのレンタルサーバープランでは、通常Node.jsを直接動作させることは公式にはサポートされていませんが、以下の方法で動作させることが可能です。
※Node.jsが利用可能なプラン（VPSやマネージド専用サーバー）の場合は、ファイルをアップロードして `node server.js` を実行するだけで動作します。

## 方法1: XServer VPS / マネージド専用サーバーの場合
1. `deploy.zip` をサーバーにアップロードし、解凍します。
2. ターミナル（SSH）で解凍したディレクトリに移動します。
3. `npm install` を実行して依存関係をインストールします。
4. `node server.js` を実行してサーバーを起動します。
   - 永続化するには `pm2` などのツールを使用することをお勧めします。

## 方法2: XServer レンタルサーバー（スタンダードプラン）の場合
レンタルサーバープランではNode.jsの常駐プロセスを実行することが難しいため、通常はPHP等の環境が推奨されます。
しかし、Node.jsを利用したい場合は、SSH接続を行い、Node.jsをインストール（またはnvm等を使用）して実行する必要があります。
**注意**: 共用サーバーでの長時間実行プロセスは制限される場合があります。

### 手順
1. **ファイルのアップロード**
   - `deploy.zip` を解凍し、中身をサーバー上の公開ディレクトリ（例: `public_html/study_app`）の**外**（例: `~/study_app`）にアップロードします。
   - 公開ディレクトリには静的ファイル（`public`フォルダの中身）のみを置く構成も可能ですが、本アプリはAPIサーバーが必要なため、Node.jsプロセスが必要です。

2. **Node.jsのセットアップ**
   - SSHでサーバーに接続します。
   - Node.jsがインストールされていない場合は、Nodebrew等を使ってインストールします。

3. **依存関係のインストール**
   - アップロードしたディレクトリで `npm install` を実行します。
     ```bash
     cd ~/study_app
     npm install
     ```

4. **サーバーの起動**
   - `PORT` 環境変数を指定して起動します（XServerで割り当てられたポート、またはリバースプロキシ設定が必要）。
   - 通常のWebアクセス（80/443）でアクセスさせるには、`.htaccess` でのリバースプロキシ設定が必要です。

   **.htaccess の例 (public_html/study_app/.htaccess)**
   ```apache
   DirectoryIndex disabled
   RewriteEngine On
   RewriteRule ^$ http://127.0.0.1:3000/ [P,L]
   RewriteRule ^(.*)$ http://127.0.0.1:3000/$1 [P,L]
   ```
   ※この設定を行うには、サーバー側で `mod_proxy` が有効である必要があります（XServerでは一部制限があります）。

### 代替案: フロントエンドのみホスティング
本アプリはSQLiteデータベースを使用するサーバーサイドアプリであるため、静的ホスティングだけでは動作しません。
もしXServerでNode.jsの運用が難しい場合は、Heroku, Render, Railway, Vercel (Serverless Functions対応が必要) などのNode.js対応ホスティングサービスの利用を検討してください。

## 必要なファイル
`deploy.zip` には以下のファイルが含まれています。
- `server.js` (サーバープログラム)
- `package.json` (設定ファイル)
- `public/` (画面などの静的ファイル)
- `database.sqlite` (データベースファイル)
- `exports/` (エクスポート用フォルダ)

## 注意事項
- `database.sqlite` には学習データが含まれています。初期化したい場合は、このファイルを削除してサーバーを起動すると、空のデータベースが再生成されます（ただしテーブル作成ロジックが `server.js` に含まれている必要があります。現在のコードでは自動生成されます）。
